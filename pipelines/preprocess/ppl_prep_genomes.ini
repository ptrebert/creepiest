[Run]
load_path= /home/pebert/work/code/mpggit/creepiest/pipelines
load_name= preprocess.ppl_prep_genomes

[Pipeline]
name= PREPGENOMES
inputfiles= /TL/deep/fhgfs/projects/pebert/thesis/refdata/genomes:/TL/deep/fhgfs/projects/pebert/thesis/refdata/chromsizes
chromtemp= /TL/deep/fhgfs/projects/pebert/thesis/refdata/chromsizes/temp
gentemp= /TL/deep/fhgfs/projects/pebert/thesis/refdata/genomes/temp
outdir= /TL/deep/fhgfs/projects/pebert/thesis/refdata/genomes
motifdb= /TL/epigenetics2/work/pebert/tools/meme/motifDB/motif_databases/JASPAR/JASPAR_CORE_2016_vertebrates.meme

filtchrom= egrep "^chr[0-9]+\s" {{inputfile}} | cut -f 1 | xargs -d '\n' -I @ touch ${chromtemp}/{ASSEMBLY[0]}_@.sg.txt
conv2bit= twoBitToFa -seq={CHROM[0]} {{referencefile}} {{outputfile}}
tfscan= fimo --verbosity 1 --max-stored-scores 1000000 --text ${motifdb} {inputfile} | cut -f 1,2,3,4,5 | gzip -c > {outputfile}
reorder= gunzip -c {inputfile} | awk 'BEGIN {{OFS="\\t"}} {{print $$2,$$3,$$4,$$1}}' | egrep "chr.+" | bedSort stdin stdout | gzip -c > {outputfile}
windows= bedtools makewindows -w 250 -g {{inputfile}} | sort -V | egrep "chr[0-9]+" | gzip -c > {{outputfile}}
overlap= bedtools intersect -wo -a ${gentemp}/{ASSEMBLY[0]}_250bp_win.bed.gz -b {{inputfile}} | gzip -c > {{outputfile}}
convert= creepiest.py -dmp ${EnvPaths:confdump}/convert -wrk 6 convert --task tfmotif -i {{inputfiles}} -o {{outputfile}} --motif-db ${motifdb} --db-format meme

[Ruffus]
use_threads= True
jobs= 32
verbose= 6
history_file= ${EnvPaths:ruffushist}/${Pipeline:name}_hist.sqlite
log_file= ${EnvPaths:ruffuslog}/${Pipeline:name}_ruffus.log

[JobConfig]
workdir= ${EnvPaths:workdir}
outpath= ${EnvPaths:ruffusdump}
errpath= ${EnvPaths:ruffusdump}
native_spec= -l mem_free=10G,slots_free=1,tmp_free=5G,h=deep1[0123456789]*|deep2[0123456789]*
scriptdir= ${EnvPaths:ruffusdump}
keepscripts= 0

[ParallelJobConfig]
workdir= ${EnvPaths:workdir}
outpath= ${EnvPaths:ruffusdump}
errpath= ${EnvPaths:ruffusdump}
native_spec= -l mem_free=20G,slots_free=7,tmp_free=10G,h=deep1[0123456789]*|deep2[0123456789]*
scriptdir= ${EnvPaths:ruffusdump}
keepscripts= 0